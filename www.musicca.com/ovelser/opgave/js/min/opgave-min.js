var MusikipediaOpgave=function(){"use strict";let e,t=0,i="",n=[],s=[],a=0,o=0,l=0,r=null,d=null,p=0,u=0,c=null;var g=!1;let m,v=null,k=null,f=null;var y=null,M=null,I=null;const T=function(){document.getElementById("opgaveoverskrift").innerHTML=n.overskrift,MusikipediaTooltips.initialisering(),function(){const e=document.getElementById("lukopgaveknap");MusikipediaTooltips.oprettetTip({element:e,tekst:n.tilbageTekst}),e.addEventListener("click",(function(){window.location.href=Musikipedia.sti()+n.cirkelurl+"/"+n.cirkelid}))}(),MusikipediaSpoergsmaaltaeller.initialisering(document.getElementById("spoergsmaaltaeller"),n.antalRigtigeForAtFaerdiggoere),""==n.tip?document.getElementById("opgavetip").style.visibility="hidden":v=MusikipediaTooltips.oprettetTip({element:document.getElementById("opgavetip"),tekst:n.tip,sticky:!0}),MusikipediaSideopsaetning.fjernHeaderIMobilFormat(),void 0!==n.tid&&(r=n.tid,document.getElementById("respons").innerHTML=Math.floor(r/60)+":"+(r%60<10?"0":"")+r%60,d=setInterval((function(){document.getElementById("respons").innerHTML=Math.floor(r/60)+":"+(r%60<10?"0":"")+r%60,r-=1,r<=0&&(clearInterval(d),L(!1))}),1e3)),null!==M&&M(n)};function E(e,a){let o=Musikipedia.xmlHttpObjekt();o.onreadystatechange=function(){4===o.readyState&&(n=JSON.parse(o.responseText),s=s.concat(n.spoergsmaal),e())},o.open("GET",Musikipedia.mappe()+"opgave/"+i+".php?foerste="+(a?"1":"0")+"&id="+t+"&sprog="+Musikipedia.sprogkode()+"&random="+Math.floor(1e5*Math.random()),!0),o.send(null)}function B(e){if(null===c){const t=s[p];c=p;do{if(c++,c>=s.length)return void E((function(){B(e)}),!1)}while(f(t,s[c]))}e()}function h(){c=null,u=0,y(s[p]),B((function(){null!==I&&I(s[c])}))}const S=function(e){w(),document.getElementById("vissvar")&&(document.getElementById("vissvar").style.display="none"),MusikipediaTooltips.skjulAlleTips(),o<n.antalRigtigeForAtFaerdiggoere?B((function(){p=c,a++,h()})):(L(!0),void 0!==e&&e())};function L(i){var s,o,l;s=new Date,document.getElementById("opgave").style.display="none",document.getElementById("respons").style.display="none",document.getElementById("afspil-lyd-felt").style.display="none",l="opgaveid="+t+"&antal_stillede_spoergsmaal="+a+"&faerdiggjort="+i+"&alleSpgBesvaretUdenFejl="+(a===n.antalRigtigeForAtFaerdiggoere)+"&tidISekunder="+Math.round((s-e)/1e3)+"&sprog="+Musikipedia.sprogkode()+"&sprogmappe="+Musikipedia.sprogmappe()+"&timezoneOffset="+s.getTimezoneOffset(),(o=Musikipedia.xmlHttpObjekt()).onreadystatechange=function(){if(4===o.readyState){var e=JSON.parse(o.responseText);if(function(e){var t;e.alleSpgBesvaretUdenFejlForFoersteGang&&(e.overskrift+="<img src='"+Musikipedia.mappe()+"grafik/ikoner/stjerne.png' alt='â˜…' class='resultatstjerne' />",document.getElementById("opgaveoverskrift").classList.add("resultatoverskriftMedStjerne"));document.getElementById("opgaveoverskrift").innerHTML=e.overskrift,t='<p id="resultatunderoverskrift">'+e.underoverskrift+"</p>",e.loggetind>0&&(t+='<p id="tildeltepoint">+'+e.tildeltePoint+"</p>",t+='<div id="venstreresultat"><div id="indrevenstreresultat">'+e.pointbar+"</div></div>",t+='<div id="hoejreresultat">'+e.cirkelhtml+"</div>");t+=e.svarknaphtml,document.getElementById("resultat").innerHTML=t,MusikipediaVisCirkel.vis(),document.addEventListener("keydown",(function(t){"Enter"!==t.code&&"NumpadEnter"!==t.code||(window.location=e.standardurl)}))}(e),0==e.loggetind){var t=Musikipedia.xmlHttpObjekt();t.onreadystatechange=function(){},t.open("POST",Musikipedia.mappe()+"opgave/save-answer.php",!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.send(l)}}},o.open("POST",Musikipedia.mappe()+"opgave/svar.php",!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.send(l)}var w=function(e,t){var i;i=document.getElementById("respons"),null==e||""===e.trim()?(void 0===n.tid&&(i.innerHTML="&nbsp;"),i.className=""):(""===e&&void 0!==n.tid||(i.innerHTML=e),i.className=void 0===t||!1!==t?"fejltekst":"")};return{initialisering:function(n,s,o,l,r,d){i=n,M=s,f=o,y=l,I=void 0!==r?r:null,d=void 0!==d?d:null,t=parseInt(Musikipedia.foraeldermappe()),e=new Date,p=0,a=1,E((function(){T(),h()}),!0)},gaaVidereMedNaesteSpoergsmaal:S,rigtigtSvar:function(){0===u&&(l=0,o+=1,MusikipediaSpoergsmaaltaeller.visHvorMangeRigtigeSvar(o))},forkertSvar:function(){0===u&&(l+=1,(l>2||o/a<.5&&a>3)&&(g||(g=!0,null!==v&&(MusikipediaTooltips.skjulAlleTips(),v.show())))),u+=1},aktueltSpoergsmaal:function(){return s[p]},userHasAnsweredTheRequiredNumberOfQuestionsCorrectly:function(){return o>=n.antalRigtigeForAtFaerdiggoere},skrivRespons:w,data:function(){return n},antalForkerteForsoegPaaDetteSporgsmaal:function(){return u},visVissvarknap:function(e){document.getElementById("vissvar")&&document.getElementById("vissvarknap")&&(document.getElementById("vissvar").style.display="block",document.getElementById("vissvarknap").innerText=n.vissvarknaptekst,document.getElementById("vissvarknap").style.display="inline",document.getElementById("vissvarknap").onclick=function(){!function(e){w(n.rigtigtSvar,!1),e(),document.getElementById("vissvar").style.display="block",document.getElementById("vissvarknap").innerText=n.naesteSpoergsmaal,document.getElementById("vissvarknap").onclick=S,document.getElementById("vissvarknap").style.display="inline"}(e)})},createLicenseTip:function(e){document.getElementById("opgave")&&(void 0===e&&(e=""),m=document.createElement("img"),m.id="copyrightbutton",m.src="/ovelser/grafik/ikoner/copyright.png",m.style.display=""==e?"none":"inline-block",k=MusikipediaTooltips.oprettetTip({element:m,tekst:e}),document.getElementById("opgave").appendChild(m))},setLicenseInfo:function(e){var t;t="","soundLicense"in e&&""!==e.soundLicense&&null!==e.soundLicense&&(t='<div class="licenseTipText"><img src="/ovelser/grafik/ikoner/audio-file.png" class="licenseTipImage" />'+e.soundLicense+"</div>"),"imageLicense"in e&&""!==e.imageLicense&&null!==e.imageLicense&&(t=t+'<div class="licenseTipText"><img src="/ovelser/grafik/ikoner/image-file.png" class="licenseTipImage" />'+e.imageLicense+"</div>"),""==t?m.style.display="none":(k.setContent(t+"</div>"),m.style.display="inline-block")}}}();