var MusikipediaHL_rytmer=function(){"use strict";let e,t,n,i,s,o=null,r=null,a=!0,l={};var p=function(t){l=t.texts,e=new MusikipediaRhythmImage({elementToWhichTheRhythmImageAreCreated:document.getElementById("spoergsmaal"),zoom:.6,editMode:!0,answerButtonText:t.svarknapNodesystem,answerFunction:u,editButtons:t.answerButtons,swingText:t.swingText}),MusikipediaRhythmPlayer.initialisation({unitsPerStep:t.greatestCommonLevelLength,elementWithButton:document.getElementById("afspil-lyd"),includeCountIn:!0,includePlaying:!0,includeTapping:!1}),document.getElementById("afspil-lyd-felt").classList.add("med-responslinje"),n=document.createElement("button"),n.addEventListener("click",(function(){e.stopEditMode();let t=new MusikipediaRhythm(r);t.improveNotation(),e.setRhythm(t),s.style.display="inline",i.style.display="inline",n.style.display="none"})),n.className="nodesvarknap",n.innerHTML=l.showBetter,n.style.display="none",i=document.createElement("button"),i.addEventListener("click",(function(){e.setRhythm(r),m(),i.style.display="none",n.style.display="inline"})),i.className="nodesvarknap",i.innerHTML=l.showOriginal,i.style.display="none",s=document.createElement("button"),s.addEventListener("click",(function(){n.style.display="none",i.style.display="none",s.style.display="none",MusikipediaOpgave.gaaVidereMedNaesteSpoergsmaal()})),s.className="nodesvarknap",s.innerHTML=t.naesteSpoergsmaal,s.style.display="none";const o=document.getElementById("vissvar").firstChild;o.appendChild(i),o.appendChild(n),o.appendChild(s),MusikipediaOpgave.skrivRespons()};function d(e,t,n){for(const i of e)if(i.components.length>0){if(d(i.components,t,n))return!0}else if(i.position>=t&&i.position<t+n&&!i.rest&&!i.barRest&&!i.tied)return!0;return!1}function m(){let t=e.getRhythm(),n=new MusikipediaRhythm(t);n.improveNotation();for(const i of t.bars){const t=i.arrayOfComponents();for(const i of t)n.exists(i)||e.markComponent(i,"!")}}var u=function(){r=new MusikipediaRhythm(e.getRhythm());let o=new MusikipediaRhythm(e.getRhythm());const a=function(){let n={errors:0,missingNotes:!1,extraNotes:0,tieErrors:0},i=e.getRhythm();i.setPositionAndTactusBeatForAllComponents(),i.setTiedForAllComponents();for(let s=0;s<i.bars.length;s++){const o=i.bars[s],r=t.bars[s],a=o.arrayOfComponents();for(const t of a)if(t.rest||t.tied)t.barRest&&(t.length=r.metricalStructure.length),d(r.components,t.position,t.length)&&(n.missingNotes=!0,n.errors++);else{const i=r.componentStartingAt(t.position);null==i||i.rest||i.barRest||i.tied?(e.markComponent(t,"÷"),n.extraNotes++,n.errors++):d(r.components,t.position+1,t.length-1)?(e.markComponent(t,"÷"),n.missingNotes=!0,n.errors++):e.markComponent(t,"√")}for(let t=0;t<a.length;t++){const o=a[t];if(o.tie){let r;if(t+1>=a.length)if(s==i.bars.length-1)r=!1;else{const e=i.bars[s+1].arrayOfComponents();r=0!=e.length&&!e[0].rest}else r=!a[t+1].rest;r||(e.markComponent(o,"÷"),n.tieErrors++,n.errors++)}}}return n}();if(0==a.errors)MusikipediaOpgave.rigtigtSvar(),o.improveNotation(),o.wasInappropriate?(MusikipediaOpgave.skrivRespons(l.inappropriateNotation),e.blinkForCorrectAnswer((function(){m(),e.showAnswerButton(!1),e.stopEditMode(),document.getElementById("vissvar").style.display="block",n.style.display="inline",i.style.display="none",s.style.display="none",document.getElementById("vissvarknap").style.display="none"}))):e.blinkForCorrectAnswer(MusikipediaOpgave.gaaVidereMedNaesteSpoergsmaal);else{let n;MusikipediaOpgave.forkertSvar();const i=t.numberOfSounds()-r.numberOfSounds();n=i>0?1===i?l.missingNotesOne:l.missingNotesMore.replace("#",i):i<0?-1===i?l.tooManyNotesOne:l.tooManyNotesMore.replace("#",-i):a.tieErrors?l.tieError:l.placedIncorrectly;const s=MusikipediaOpgave.antalForkerteForsoegPaaDetteSporgsmaal()<3;n+=" "+(s?l.tryAgain:l.clickToShowCorrectAnswer),MusikipediaOpgave.skrivRespons(n),s?e.indicateWrongAnswer():e.blinkForWrongAnswer((function(){e.stopEditMode(),MusikipediaOpgave.visVissvarknap(k)}))}},y=function(e,t){if(null===e||null===t)return!1;{const n=new MusikipediaRhythm(e),i=new MusikipediaRhythm(t);return n.isEqualTo(i)}},c=function(n){t=null===o?new MusikipediaRhythm(n):o;const i=t.emptyClone();e.setRhythm(i),e.startEditMode(),t.setPositionAndTactusBeatForAllComponents(),t.setTiedForAllComponents(),MusikipediaRhythmPlayer.stop(),MusikipediaRhythmPlayer.setRhythm(t),a||MusikipediaRhythmPlayer.play(),a=!1},h=function(e){o=new MusikipediaRhythm(e)},g=function(){MusikipediaRhythmPlayer.shutDown()},k=function(){e.setRhythm(t)};return{initialisering:function(){MusikipediaOpgave.initialisering("HL_rytmer",p,y,c,h,g)}}}();window.addEventListener("load",MusikipediaHL_rytmer.initialisering());