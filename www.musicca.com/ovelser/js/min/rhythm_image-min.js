//! EDIT BUTTONS
function MusikipediaEditButton(e,t,n,s,i,o){"use strict";this.buttonElement=document.createElement("input"),s?(this.buttonElement.setAttribute("type","radio"),this.buttonElement.setAttribute("name","modeButton")):this.buttonElement.setAttribute("type","checkbox"),this.buttonElement.value=i,this.changeFunction=o,this.imageElement=document.createElement("img"),this.imageElement.alt=n,this.imageElement.src="/ovelser/grafik/ikoner/"+t+".png",this.imageElement.height=32,this.imageElement.width=32;const l=document.createElement("label");l.appendChild(this.buttonElement),l.appendChild(this.imageElement),this.buttonElement.addEventListener("change",(function(e){l.className=this.checked&&!this.disabled?"valgt":"",o(e)})),this.labelElement=l,e.appendChild(l)}
//! RHYTHM IMAGE
function MusikipediaRhythmImage(e){"use strict";const t=110,n=160,s=190,i=16,o=29,l=24,a=29,r=60,c=40,u=2,m=12,h=10,d=5,p=.1;let f,b,g,x,y,E,k,v,B,w,C,N,L,A,T,S,R,M,W,O,I,V="",D=[],H=null,F=[];
//! COMPONENT WITH ELEMENTS
function z(e){if(this.element=null,this.dotElement=null,this.tieElement=null,this.tripletElements=[],MusikipediaRhythmComponent.call(this,e),e){if(void 0!==e.components){this.components=[];for(const t of e.components)this.components.push(new z(t))}this.line=void 0!==e.line?e.line:null}}
//! BAR WITH ELEMENTS
function Z(e){this.barLineElement=null,MusikipediaBar.call(this,e);const t=e.components;this.components=[];for(const e of t)this.components.push(new z(e));e&&(this.barLineElement=void 0!==e.barLineElement?e.barLineElement:null)}
//! RHYTHM WITH ELEMENTS
function q(e){MusikipediaRhythm.call(this,e);let t=e.bars;this.bars=[];for(const e of t)this.bars.push(new Z(e));this.lines=1}
//! CREATE NEW SVG ELEMENTS
function P(e){const t=document.createElementNS("http://www.w3.org/2000/svg","line");return void 0!==e.id&&(t.id=e.id),void 0!==e.stroke&&(t.style.stroke=e.stroke),void 0!==e.x&&(t.setAttribute("x1",e.x),t.setAttribute("x2",e.x)),void 0!==e.x1&&t.setAttribute("x1",e.x1),void 0!==e.x2&&t.setAttribute("x2",e.x2),void 0!==e.y&&(t.setAttribute("y1",e.y),t.setAttribute("y2",e.y)),void 0!==e.y1&&t.setAttribute("y1",e.y1),void 0!==e.y2&&t.setAttribute("y2",e.y2),void 0!==e.width?t.style["stroke-width"]=e.width:t.style["stroke-width"]=Math.max(Math.floor(2*x),1),L.appendChild(t),t}function j(e){const t=document.createElementNS("http://www.w3.org/2000/svg","text");return void 0!==e.id&&(t.id=e.id),void 0!==e.fill?t.setAttribute("fill",e.fill):t.setAttribute("fill","#000"),void 0!==e.content&&(t.textContent=e.content),void 0!==e.x&&t.setAttribute("x",e.x),void 0!==e.y&&t.setAttribute("y",e.y),void 0!==e.fontFamily?t.style.fontFamily=e.fontFamily:t.style.fontFamily="'Helsinki Std'",void 0!==e.fontSize?t.style.fontSize=e.fontSize:t.style.fontSize=84*x+"px",L.appendChild(t),t}function X(e){const t=document.createElementNS("http://www.w3.org/2000/svg","path");return void 0!==e.strokeWidth?t.style["stroke-width"]=e.strokeWidth:t.style["stroke-width"]=x,t.setAttribute("d",e.d),L.appendChild(t),t}
//! DISTANCES AND WIDTHS
function Y(e,t){if(e.isTriplet()){let n=0;for(let s=0;s<e.components.length;s++){n+=Y(e.components[s],s<e.components.length-1?e.components[s+1]:t)}return n}if(void 0!==e.beamRight)switch(e.length){case 108:return.6;case 72:case 48:case 24:return.5;case 36:return t?36===t.length?.4:(e.beamLeft,.5):.5;default:return.7}else if(void 0!==e.beamLeft)switch(e.length){case 108:return.8;case 72:case 48:default:return.7;case 36:case 24:return.6}else if(e.rest){if(e.barRest)return 2.5;switch(e.length){case 864:return 2.7;case 576:return 2.5;case 384:return 1.6;case 432:return 1.85;case 288:return 1.7;case 192:case 216:return 1.2;case 144:default:return 1;case 96:return.8;case 108:return.7;case 72:return.6;case 48:case 36:case 24:return.5}}else switch(e.length){case 864:return 2.7;case 576:return 2.5;case 384:case 288:return 1.7;case 432:return 1.85;case 192:case 216:return 1.2;case 144:default:return 1;case 96:case 108:case 72:case 48:case 36:case 24:return.8}}function Q(e,t){const n=t.components[e];return e+1>=t.components.length?Y(n):Y(n,t.components[e+1])}function U(e){let t=0,n=0,s=N;for(;s.offsetParent;)t+=s.offsetLeft,n+=s.offsetTop,s=s.offsetParent;return{x:e.x-t,y:e.y-n}}function _(e){for(let t=0;t<H.bars.length;t++){const n=H.bars[t];for(let s=0;s<n.components.length;s++){const i=n.components[s];if(i.element===event.target)return{barNumber:t,index:s,component:i,tie:!1};if(i.tieElement===event.target||i.tieElement2===event.target)return{barNumber:t,index:s,component:i,tie:!0};if(i.tripletElements.some((t=>t===e)))return{barNumber:t,index:s,component:i,tie:!1};for(let e=0;e<i.components.length;e++){const n=i.components[e];if(n.element===event.target)return{barNumber:t,index:s,tripletIndex:e,component:i,tie:!1};if(n.tieElement===event.target||n.tieElement2===event.target)return{barNumber:t,index:s,tripletIndex:e,component:i,tie:!0}}}}return null}function G(e){let s={};const i=function(e){const s=(t-.66*n)*x;let i=Math.floor((e.y-s)/(n*x));for(const t of H.bars)if(t.line===i&&e.x>=0&&e.x<t.barLineElement.getAttribute("x1"))return t;return null}(e);if(!i)return null;s.barNumber=i.barNumber,s.line=i.line,s.component=null;let o=null,l=null;const a=i.arrayOfComponents();for(const t of a)if(t.x<=e.x&&(o=t),t.x>e.x&&null===l){l=t;break}if(i.isBarRest()){const t=i.x,n=(i.barLineElement.getAttribute("x1")-t)/i.metricalStructure.numberOfBeatsOfTactusLevel(),o=Math.max(1,Math.floor((e.x-t)/n)+1);s.position=i.metricalStructure.positionOfTactusBeat(o),s.x=t+(o-1)*n}else if(null===o)null!==l&&(s.position=l.position,s.x=l.x,s.component=l);else if(null===l)if(o.tactusBeat===i.metricalStructure.numberOfBeatsOfTactusLevel())s.position=o.position,s.x=o.x;else{const t=o.x,n=i.barLineElement.getAttribute("x1")-t,l=i.metricalStructure.length-o.position,a=o.position+Math.round((e.x-t)/n*l),r=i.metricalStructure.tactusBeatOfPosition(a),c=i.metricalStructure.positionOfTactusBeat(r);c<=o.position?(s.position=o.position,s.x=o.x,s.component=o):(s.position=c,s.x=t+(c-o.position)/l*n)}else{const t=(r=o,c=l,H.metricalStructure.isOnTactusBeat(c.position)?c.tactusBeat-r.tactusBeat-1:c.tactusBeat-r.tactusBeat);if(0===t){const t=function(e,t,n){return Math.abs(n.x-e.x)<=Math.abs(n.x-t.x)?e:t}(o,l,e);s.position=t.position,s.x=t.x,s.component=t}else{const n=o.x,i=l.x,a=o.tactusBeat+Math.round((e.x-n)/(i-n)*t);if(o.tactusBeat===a)s.position=o.position,s.x=o.x,s.component=o;else{const e=H.metricalStructure.positionOfTactusBeat(a);l.position==e?(s.position=l.position,s.x=l.x,s.component=l):(s.position=e,s.x=n+(a-o.tactusBeat-.5)*(i-n)/t)}}}var r,c;return void 0!==s.position?s:null}
//! RHYTHM IMAGE
function J(){return y?Math.min(y,N.offsetWidth):N.offsetWidth}
//! CREATING AND DRAWING
function K(e){P({x1:e.x,x2:J(),y:e.y})}function ee(e){e.x+=i*x,j({id:"keyElement",content:"/",x:e.x,y:e.y+20*x}),e.x+=o*x}function te(e){e.x+=l*x,j({content:H.metricalStructure.timeSignature.beats,x:e.x,y:e.y-22*x}),j({content:H.metricalStructure.lengthText(),x:e.x+(H.metricalStructure.timeSignature.beats<10?0:12*x),y:e.y+22*x}),e.x+=a*x}function ne(e){const t=j({x:e.x});let n=e.y;if(t.className.baseVal=e.mark,e.rest)switch(e.length){case 864:case 576:case 384:t.textContent="Ã“",n+=9*x;break;case 432:case 288:case 192:t.textContent="Ã“",n-=1*x;break;case 216:case 144:case 96:t.textContent="Å’",n-=21*x;break;case 108:case 72:case 48:t.textContent="â€°",n-=11*x;break;case 36:case 24:t.textContent="â‰ˆ",n-=30*x;break;default:t.textContent=""}else if(void 0!==e.beamLeft||void 0!==e.beamRight)t.textContent="q",n+=11*x;else switch(e.length){case 864:case 576:case 384:t.textContent="w";break;case 432:case 288:case 192:t.textContent="h",n+=11*x;break;case 216:case 144:case 96:t.textContent="q",n+=11*x;break;case 108:case 72:case 48:t.textContent="e",n+=11*x;break;case 36:case 24:t.textContent="x",n+=11*x;break;default:t.textContent=""}if(t.setAttribute("y",n),e.element=t,[864,432,216,108].includes(e.length)){let t,s;if(e.rest)switch(e.length){case 864:t=29,s=-17;break;case 432:t=30,s=-8;break;case 216:t=22,s=-8;break;case 108:t=26,s=-10}else switch(e.length){case 864:t=42,s=-9;break;case 432:case 216:case 108:t=33,s=-19}e.dotElement=j({content:".",x:e.x+t*x,y:n+s*x,fontSize:100.8*x+"px"}),e.dotElement.className.baseVal=e.mark}}function se(e){const t=H.bars[e.barNumber].components[e.i];if(t.x=e.x,t.y=e.y,t.barRest)!function(e,t){const n=j({x:e.x-t*p*.8+Y(e)*t/2});n.className.baseVal=e.mark,n.textContent="Ã“",n.setAttribute("y",e.y+9*x),e.element=n}(t,e.distanceBetweenCrotchets);else if(t.isTriplet()){let s=e.x;for(let n=0;n<t.components.length;n++){let i=t.components[n];i.x=s,i.y=e.y,ne(i),i.line=e.line,n+1<t.components.length&&(s+=Y(i,t.components[n+1])*e.distanceBetweenCrotchets)}!function(e){if(e.isTriplet()){const t=e.components[0],s=e.components[1],i=e.components[e.components.length-1],o=3===e.components.length?s.x+21*x:(t.x+i.x)/2+20*x,l=b+n*t.line*x,a=j({content:"3",x:o-5*x,y:l-93*x,fontSize:42*x+"px"});if(e.tripletElements.push(a),void 0===t.beamRight||void 0===s.beamRight&&e.components.length>2){const n=l-94*x,s=l-78*x,a=t.x+1*x,r=i.x+39*x,c=P({x:a,y1:s,y2:n});e.tripletElements.push(c);const u=P({x:r,y1:s,y2:n});e.tripletElements.push(u);const m=P({x1:a,x2:o-15*x,y:n});e.tripletElements.push(m);const h=P({x1:o+15*x,x2:r,y:n});e.tripletElements.push(h)}}}(t)}else ne(t);t.line=e.line,e.x+=Q(e.i,H.bars[e.barNumber])*e.distanceBetweenCrotchets}function ie(e,t){var n,s;n=u*x,H.bars[e.barNumber].barLineElement=P({x:e.x+n/2,y1:e.y-21*x,y2:e.y+21*x,width:n}),t?(s=(m-u+2*u)*x,P({x:e.x+3*n+s/2,y1:e.y-21*x,y2:e.y+21*x,width:s}),e.x+=m*x):e.x+=u*x+c*x+e.distanceBetweenCrotchets*p}function oe(e){const t=r*(1+J()/800)/2;e.x+=t*x;const n=e.numberOfBarsInLines[e.line];for(let t=0;t<n;t++){const t=H.bars[e.barNumber];for(t.line=e.line,t.x=e.x,e.i=0;e.i<t.components.length;e.i++)se(e),e.i+1>=t.components.length&&(e.barNumber+1>=H.bars.length?ie(e,!0):ie(e));e.barNumber++}}function le(e){const t=function(){let e=0;for(const t of H.bars)for(let n=0;n<t.components.length;n++)e+=Q(n,t);return e}()+p*(H.bars.length-1),i=J()/t/x;if(i<120){let t=i<40?4:i<60?3:2;3==t&&4==H.bars.length&&(t=4);const n=function(e,t){function n(e){let t=0;for(const n of e)t+=n.chunkWidth;return t+=p*(e.length-1),t}return function(e){for(const t of e){t.chunkWidth=0;for(let e=0;e<t.components.length;e++)t.chunkWidth+=Q(e,t)}}(e),function e(t,s){if(1==s){const e={bars:t,chunkWidth:n(t)};return{lines:[e],minChunkWidth:e.chunkWidth,maxChunkWidth:e.chunkWidth}}{let i=null;const o=t.length-s+1;for(let l=1;l<=o;l++){const o=t.slice(0,l),a=e(t.slice(l),s-1),r={bars:o,chunkWidth:n(o)};let c={lines:[r].concat(a.lines),minChunkWidth:Math.min(r.chunkWidth,a.minChunkWidth),maxChunkWidth:Math.max(r.chunkWidth,a.maxChunkWidth)};if(null==i)i=c;else{const e=c.maxChunkWidth-c.minChunkWidth;i.maxChunkWidth-i.minChunkWidth>=e&&(i=c)}}return i}}(e,Math.min(t,e.length))}(H.bars,t);e.chunkWidthOfLines=n.lines.map((e=>e.chunkWidth)),e.numberOfBarsInLines=n.lines.map((e=>e.bars.length)),H.lines=t}else e.chunkWidthOfLines=[t],e.numberOfBarsInLines=[H.bars.length],H.lines=1;g=Math.round((s+n*(H.lines-1))*x),L.setAttribute("viewBox","0 0 "+N.offsetWidth+" "+g)}function ae(e){let t,s;e.x=0,e.y=b+n*e.line*x;const h=r*(1+J()/800)/2;s=0===e.line?(i+o+l+a+h)*x:(i+o+h)*x;let d=(e.numberOfBarsInLines[e.line]-1)*(u+c);e.line+1===H.lines?d+=m:d+=u,t=d*x,e.distanceBetweenCrotchets=(J()-s-t)/e.chunkWidthOfLines[e.line]}function re(){H=new q(H);const e=function(){H.setPositionAndTactusBeatForAllComponents(),H.markNotesWithBeams();const e={i:0,barNumber:0};return le(e),b=Math.round(f*x),e}();for(H.clearImage(),L.setAttribute("viewBox","0 0 "+N.offsetWidth+" "+g),void 0!==H.metricalStructure.swingLevel&&void 0!==H.metricalStructure.swingRatio&&function(e){const t=j({content:C,x:48*x,y:28*x,fontFamily:"'Open Sans', sans-serif",fontSize:77/3*x+"px"});t.style.fontStyle="italic",t.style.fontWeight=600}(),e.line=0;e.line<H.lines;e.line++)ae(e),K(e),ee(e),0===e.line&&te(e),oe(e);!function(e){function t(e,t){const s=b+n*e.line*x;P({x1:e.x+25*x,x2:t.x+25*x,y:s-68*x,width:h*x})}function s(e,t){const s=b+n*e.line*x,i=P({width:h*x,y:s-(68-h-d)*x});t?(i.setAttribute("x1",e.x+25*x-25*x),i.setAttribute("x2",e.x+25*x)):(i.setAttribute("x1",e.x+25*x),i.setAttribute("x2",e.x+25*x+25*x))}function i(e,t){const i=b+n*e.line*x,o=P({width:h*x,y:i-(68-h-d)*x});e===t?s(e,void 0===t.beamRight):(o.setAttribute("x1",e.x+25*x),o.setAttribute("x2",t.x+25*x))}function o(e){for(let n=0;n<e.length;n++){const s=e[n];if(void 0===s.beamRight)void 0!==s.components&&o(s.components);else{let i=s;do{n++,i=e[n]}while(void 0!==i.beamRight);void 0!==i.components&&i.components.length>0&&(i=i.components[i.components.length-1]),t(s,i)}}}function l(e){3===e.length?e[0].rest?e[1].rest||e[2].rest||i(e[1],e[2]):e[1].rest||(e[2].rest?i(e[0],e[1]):i(e[0],e[2])):2!==e.length||e[0].rest||e[1].rest||(24===e[0].length?s(e[0],!1):s(e[1],!0))}function a(e){for(let t=0;t<e.length;t++){const n=e[t];if(void 0!==n.components&&n.components.length>1&&72===n.length)l(n.components);else if(void 0===n.beamRight)void 0!==n.beamLeft&&(36!==n.length&&24!==n.length||i(n,n));else if(36===n.length||24===n.length){let o=n;for(;t<e.length-1&&void 0!==o.beamRight;){const n=e[t+1];if(36!==n.length&&24!==n.length)break;t++,o=e[t]}n===o?void 0===n.beamLeft?s(n,!1):s(n,H.metricalStructure.highestLevel(n.position)>=H.metricalStructure.highestLevel(n.position+n.length)):i(n,o)}}}for(const e of H.bars)o(e.components),a(e.components)}(),function(e){const t="M1.247833,0.5146937 C15.247833,10.9146937 59.247833,10.9146937 74.247833,0.5146937 C59.247833,17.848027 15.247833,17.848027 1.247833,0.5146937 Z";for(let e=0;e<H.bars.length;e++){const s=H.bars[e],i=s.arrayOfComponents();for(let o=0;o<i.length;o++){const l=i[o],a=b+n*l.line*x;if(l.tie){let r=null;if(o+1<i.length?r=i[o+1]:e+1<H.bars.length&&(r=H.bars[e+1].arrayOfComponents()[0]),null!==r)if(l.tieElement=X({d:t}),l.line===r.line){const e=r.x-l.x;l.tieElement.setAttribute("transform","translate("+(l.x+14*x)+","+(a+16*x)+"), scale("+.0126*e+","+1.1*x+")")}else{const e=s.barLineElement.getAttribute("x1")-l.x-8;if(l.tieElement.setAttribute("transform","translate("+(l.x+14*x)+","+(a+16*x)+"), scale("+.0126*e+","+1.1*x+")"),!H.bars[s.barNumber+1].isBarRest()){const e=r.x-54*x,s=r.x-e;l.tieElement2=X({d:t}),l.tieElement2.setAttribute("transform","translate("+(e+14*x)+","+(a+n*x+16*x)+"), scale("+.0126*s+","+1.1*x+")")}}}}}}()}
//! BUTTONS
function ce(e,t,n,s,i,o){const l=document.createElement("input");n?(l.setAttribute("type","radio"),l.setAttribute("name","modeButton")):l.setAttribute("type","checkbox"),l.value=s,l.addEventListener("change",i);const a=document.createElement("img");a.alt=t,a.src="/ovelser/grafik/ikoner/"+e+".png",a.height=32,a.width=32;const r=document.createElement("label");return r.appendChild(l),r.appendChild(a),o&&function(e,t,n){if(e){n=void 0!==n&&n;const s=e.firstChild,i=e.lastChild;t?(n&&function(e,t){if(e){const n=e.firstChild;n.disabled||(n.checked=t),e.className=n.checked&&!n.disabled?"valgt":""}}(e,!1),e.style.opacity=.6,i.style.opacity=.5,e.style.cursor="not-allowed",e.className="",s.disabled=!0):(e.style.opacity=1,i.style.opacity=1,e.style.cursor="pointer",s.checked?e.className="valgt":e.className="",s.disabled=!1)}}(r,o),n&&D.push(r),r}function ue(){M&&(M.innerHTML=V,M.className=M.className.replace(/(?:^|\s)rigtigt(?!\S)/g,""),M.className=M.className.replace(/(?:^|\s)forkert(?!\S)/g,""),M.disabled=!1)}function me(e){M&&(M.style.display=e?"inline":"none")}function he(e){if(null==A){A=document.createElement("p"),A.style.maxWidth="100%",A.classList.add("svarknapper");const t=e.split(",");let n=0,s=document.createElement("div");A.appendChild(s),s.className="notes-and-rests-buttons",t.includes("1")&&(s.appendChild(ce("note-576","ð…",!0,"576",fe)),n++),t.includes("2")&&(s.appendChild(ce("note-288","ð…ž",!0,"288",fe)),n++),t.includes("4")&&(s.appendChild(ce("note-144","ð…Ÿ",!0,"144",fe)),n++),t.includes("8")&&(s.appendChild(ce("note-72","ð… ",!0,"72",fe)),n++),t.includes("16")&&(s.appendChild(ce("note-36","ð…¡",!0,"36",fe)),n++),(t.includes("r")||t.includes("rests"))&&(s.appendChild(document.createElement("br")),t.includes("1")&&s.appendChild(ce("rest-576","ð„»",!0,"-576",fe)),t.includes("2")&&s.appendChild(ce("rest-288","ð„¼",!0,"-288",fe)),t.includes("4")&&s.appendChild(ce("rest-144","ð„½",!0,"-144",fe)),t.includes("8")&&s.appendChild(ce("rest-72","ð„¾",!0,"-72",fe)),t.includes("16")&&s.appendChild(ce("rest-36","ð„¿",!0,"-36",fe)));let i=document.createElement("div");i.className="extras-rhythm-buttons";let o=!1,l=document.createElement("span");if(l.className="special-rhythm-buttons",i.appendChild(l),(t.includes(".")||t.includes("dot"))&&(T=new MusikipediaEditButton(l,"note-dot",".",!1,".",be),T.disableButton(!0),n++,o=!0),(t.includes("u")||t.includes("tie"))&&(S=new MusikipediaEditButton(l,"note-tie","â€¿",!1,"tie",ge),S.disableButton(!0),n++,o=!0),(t.includes("3")||t.includes("triplet"))&&(R=new MusikipediaEditButton(l,"note-triplet","3",!1,"triplet",xe),R.disableButton(!0),n++,o=!0),!o){let e=document.createElement("img");e.src="/ovelser/grafik/button-block.png",e.height="53px",l.appendChild(e),n++}if(i.style.maxWidth=60*n+20+"px",A.appendChild(i),t.includes("d")||t.includes("delete")||t.includes("e")||t.includes("erase")){const e=ce("noder-slet","âŒ«",!0,"erase",fe);e.className="erase-rhythm-button",i.appendChild(e)}N.appendChild(A);const a=document.createElement("p");a.style.maxWidth="100%",a.style.clear="both",a.classList.add("svarknapper"),a.appendChild(function(e,t){return M=document.createElement("button"),M.setAttribute("id",N.id+"_svarknap"),M.addEventListener("click",(function(){pe(""),null!==t&&t()})),M.className="nodesvarknap",M.innerHTML=e,M.disabled=!0,M}(V,B)),N.appendChild(a)}"undefined"!=typeof MusikipediaOpgave&&MusikipediaOpgave.skrivRespons(),ue(),M&&(M.disabled=!0)}function de(){let e=0;for(const t of D){const n=t.firstChild;n.checked&&(e=n.value)}0===e?v&&(v.removeElements(),v=null):(v||(v=new z),parseInt(e)>0?(v.length=parseInt(e),v.rest=!1):(v.length=-parseInt(e),v.rest=!0,S&&S.setButton(!1)),v.tie=!1,R&&R.isChecked()?v.length=2*v.length/3:(T&&T.isChecked()&&(v.length+=v.length/2),S&&(v.tie=S.isChecked()&&!v.rest)))}function pe(e){if((k||"erase"===e||""===e)&&(T&&T.disableButton(!0,!0),S&&S.disableButton(!0,!0),R&&R.disableButton(!0,!0)),k="erase"===e,k){N.style.cursor="url(/ovelser/grafik/slettecursor.cur), url(/ovelser/grafik/slettecursor.png), pointer";for(let e of D){const t=e.firstChild;t.checked="erase"===t.value,e.className=t.checked?"valgt":""}}else{for(let t of D){const n=t.firstChild;n.checked=n.value===e,t.className=n.checked?"valgt":""}N.style.cursor="pointer",de()}ue()}function fe(e){const t=e.target.value;for(const e of D){const t=e.firstChild;e.className=t.checked?"valgt":""}pe(t),k||(T&&T.setButton(!1),de(),S&&S.disableButton(v.rest,!0),T&&T.disableButton(v.length<72,!0),R&&R.disableButton(!1,!0))}function be(e){e.target.checked&&R&&R.setButton(!1),de(),ue()}function ge(e){e.target.checked&&R&&R.setButton(!1),de(),ue()}function xe(e){e.target.checked&&(S&&S.setButton(!1),T&&T.setButton(!1)),de(),ue()}
//! EDITING
function ye(e){E=!0,null==A&&(he(e.editButtons),L.addEventListener("mousemove",ke),L.addEventListener("touchmove",ke),L.addEventListener("mousedown",we),L.addEventListener("touchstart",ve),L.addEventListener("mouseup",Ce),L.addEventListener("touchend",Be)),A.style.display="block",me(!0)}function Ee(e,t){if(!e.tripletElements.some((e=>e===t))){for(const t of e.tripletElements)t.className.baseVal=void 0!==e.mark?e.mark:"";return e.element===t?(e.rest||e.locked||(e.element&&(e.element.className.baseVal="toneDerSlettes"),e.dotElement&&(e.dotElement.className.baseVal="toneDerSlettes"),e.tieElement&&(e.tieElement.className.baseVal="toneDerSlettes"),e.tieElement2&&(e.tieElement2.className.baseVal="toneDerSlettes")),!0):(e.element&&(e.element.className.baseVal=void 0!==e.mark?e.mark:""),e.dotElement&&(e.dotElement.className.baseVal=void 0!==e.mark?e.mark:""),e.tieElement===t||e.tieElement2===t?(e.tieElement&&(e.tieElement.className.baseVal="toneDerSlettes"),e.tieElement2&&(e.tieElement2.className.baseVal="toneDerSlettes"),!0):(e.tieElement&&(e.tieElement.className.baseVal=""),e.tieElement2&&(e.tieElement2.className.baseVal=""),!1))}for(const t of e.tripletElements)t.className.baseVal="toneDerSlettes";for(const t of e.components)t.element&&(t.element.className.baseVal="toneDerSlettes");e.tieElement&&(e.tieElement.className.baseVal="toneDerSlettes"),e.tieElement2&&(e.tieElement2.className.baseVal="toneDerSlettes")}function ke(e){var t;if(E)if(k){v&&(v.removeElements(),v=null);const t=function(e){let t=null;for(const n of H.bars)for(const s of n.components){for(const n of s.components)if(Ee(n,e)){t=n;break}if(Ee(s,e)){t=s;break}}return t}(e.target);t&&(t.rest||t.locked)?N.style.cursor="not-allowed":N.style.cursor="url(/ovelser/grafik/slettecursor.cur), url(/ovelser/grafik/slettecursor.png), pointer"}else if(t="touchmove"===e.type||"touchstart"===e.type?U({x:e.touches[0].pageX,y:e.touches[0].pageY}):U({x:e.pageX,y:e.pageY}),v)if(v.removeElements(),v.position=null,v.barNumber=null,t.y<Math.round((s+n*(H.lines-1))*x)){const e=G(t);e?H.insertOk(new MusikipediaRhythmComponent({length:v.length,rest:v.rest,tie:v.tie,position:e.position,barNumber:e.barNumber}))?(N.style.cursor="pointer",v.position=e.position,v.barNumber=e.barNumber,v.mark="toneDerIndsaettes",v.line=e.line,v.x=e.x,v.y=b+n*e.line*x,ne(v),v.tie&&function(e){const t=b+n*(e.line?e.line:0)*x;e.tieElement=X({d:"M1.247833,0.5146937 C15.247833,10.9146937 59.247833,10.9146937 74.247833,0.5146937 C59.247833,17.848027 15.247833,17.848027 1.247833,0.5146937 Z"}),e.tieElement.setAttribute("transform","translate("+(e.x+14*x)+","+(t+16*x)+"), scale(0.4,"+1.1*x+")")}(v)):N.style.cursor="not-allowed":N.style.cursor="default"}else N.style.cursor="default"}function ve(e){e.preventDefault(),ke(e)}function Be(e){e.preventDefault(),Ce(e)}function we(e){}function Ce(e){if(E&&k){const t=_(e.target);t&&(t.component.locked||t.component.rest||(t.tie?t.component.setTie(!1):H.delete(t.barNumber,t.index,t.tripletIndex),re()))}E&&!k&&null!==v&&null!==v.position&&(v.mark="normal",H.insert(v),v.removeElements(),S&&S.setButton(!1),T&&T.setButton(!1),R&&R.setButton(!1),de(),re()),"undefined"!=typeof MusikipediaOpgave&&MusikipediaOpgave.skrivRespons(),ue()}function Ne(e,t,n){const s=X({d:"M492.364405,76.38793 L428.129405,12.15293 C412.927405,-3.04907 388.275405,-3.04907 373.073405,12.15293 L252.258405,132.966933 L131.437405,12.15193 C116.235405,-3.05007 91.584405,-3.05007 76.382405,12.15193 L12.152397,76.38793 C-3.049603,91.58993 -3.049603,116.241933 12.152397,131.443933 L132.973405,252.258923 L12.152397,373.072923 C-3.049603,388.274923 -3.049603,412.926923 12.152397,428.128923 L76.387405,492.357923 C91.589405,507.559923 116.241405,507.559923 131.443405,492.357923 L252.258405,371.543923 L373.080405,492.357923 C388.282405,507.559923 412.934405,507.559923 428.136405,492.357923 L492.371405,428.128923 C507.573405,412.926923 507.573405,388.274923 492.371405,373.072923 L371.544405,252.258923 L492.364405,131.443933 C507.566405,116.234933 507.566405,91.58993 492.364405,76.38793 Z",strokeWidth:80});void 0!==n&&(s.className.baseVal=n),s.setAttribute("transform","translate("+(e-12*x)+","+(t-9*x)+"), scale("+.04*x+","+.04*x+")"),F.push(s)}function Le(e,t){let n;switch(t){case"<":case">":n="closeRhythmNote";break;case"Ã·":n="missingRhythmNote";break;default:n="wrongRhythmNote"}let s=e.x+13*x;switch(576!=e.length&&864!=e.length&&384!=e.length||(s+=4.5*x),t){case"Â«":s-=20*x;break;case"<":s-=10*x;break;case">":s+=10*x;break;case"Â»":s+=20*x}const i=e.y+29*x;"âˆš"===t?
//! LABELS
function(e,t){const n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttributeNS(null,"cx",e),n.setAttributeNS(null,"cy",t),n.setAttributeNS(null,"r",11*x),n.style["stroke-width"]=0,n.className.baseVal="rigtigTone",F.push(n),L.appendChild(n)}(s,i):Ne(s,i,n)}
//! MARKING
function Ae(e,t){H.elementsOf(e.barNumber,e.position).forEach((e=>{new RegExp("(\\s|^)"+t+"(\\s|$)").test(e.getAttribute("class"))||e.setAttribute("class",e.getAttribute("class")+" "+t)}))}function Te(e,t){H.elementsOf(e.barNumber,e.position).forEach((e=>{if(new RegExp("(\\s|^)"+t+"(\\s|$)").test(e.getAttribute("class"))){const n=e.getAttribute("class").replace(new RegExp("(\\s|^)"+t+"(\\s|$)","g"),"$2");e.setAttribute("class",n)}}))}
//! INITIALISATION
E=!!e.editMode,k=!1,v=null,x=void 0!==e.zoom?e.zoom:1,y=void 0!==e.maxWidth?e.maxWidth:null,f=void 0!==e.distanceFromTop?e.distanceFromTop:t,b=Math.round(f*x),g=Math.round(s*x),V=void 0!==e.answerButtonText?e.answerButtonText:"?",B=void 0!==e.answerFunction?e.answerFunction:null,w=void 0!==e.resizeFunction?e.resizeFunction:null,N=e.elementToWhichTheRhythmImageAreCreated,C=void 0!==e.swingText?e.swingText:"Swing",N.classList.add("nodebillede"),N.classList.add("rytmenodebillede"),E?N.classList.add("nodeskrivning"):N.classList.add("nodelaesning"),L=document.createElementNS("http://www.w3.org/2000/svg","svg"),L.setAttribute("viewBox","0 0 "+N.offsetWidth+" "+g),N.appendChild(L),E&&ye(e),window.addEventListener("resize",(function(){w&&w(N.offsetWidth);L.setAttribute("viewBox","0 0 "+N.offsetWidth+" "+g),re()})),document.addEventListener("keydown",(function(e){var t;if(t=e.key||e.keyCode,"Enter"===e.code||"NumpadEnter"===e.code||"Enter"===t||"NumpadEnter"===t)M&&(M.disabled||null!==B&&(pe(""),B()));else if("Delete"===t||"Delete"===e.code||"Del"===t||"Del"===e.code)pe("erase");else if("Escape"===t||"Escape"===e.code||"Esc"===t||"Esc"===e.code)pe("");else{switch(t){case"e":pe("erase");break;case".":T&&(T.setButton(!T.isChecked()),R&&R.setButton(!1),de());break;case"t":case"s":case"-":S&&(S.setButton(!S.isChecked()),R&&R.setButton(!1),de());break;case"3":R&&(R.setButton(!R.isChecked()),S&&S.setButton(!1),T&&T.setButton(!1),de());break;case"1":pe("576");break;case"2":pe("288");break;case"4":pe("144");break;case"8":pe("72")}ue()}})),z.prototype=Object.create(MusikipediaRhythmComponent.prototype),z.prototype.constructor=z.prototype,z.prototype.allElements=function(){let e=[];if(this.element&&e.push(this.element),this.dotElement&&e.push(this.dotElement),this.tieElement&&e.push(this.tieElement),this.tieElement2&&e.push(this.tieElement2),this.tripletElements)for(const t of this.tripletElements)e.push(t);if(this.components)for(const t of this.components)e.push(...t.allElements());return e},z.prototype.removeElements=function(){if(this.element&&(this.element.remove(),this.element=null),this.dotElement&&(this.dotElement.remove(),this.dotElement=null),this.tieElement&&(this.tieElement.remove(),this.tieElement=null),this.tieElement2&&(this.tieElement2.remove(),this.tieElement2=null),this.tripletElements){for(const e of this.tripletElements)e.remove();this.tripletElements=[]}if(this.components)for(const e of this.components)e.removeElements()},z.prototype.canHaveBeamLeft=function(){return this.isTriplet()?144!==this.length&&(this.components[0].canHaveBeamLeft()&&this.components[0].beamRight):!this.rest&&this.length<144&&96!==this.length},z.prototype.canHaveBeamRight=function(){return this.isTriplet()?144!==this.length&&(this.components[this.components.length-1].canHaveBeamRight()&&this.components[this.components.length-2].canHaveBeamRight()):!this.rest&&this.length<144&&96!==this.length},z.prototype.setBeamLeft=function(e){this.isTriplet()&&(this.components[0].beamLeft=e),this.beamLeft=e},z.prototype.setBeamRight=function(e){this.isTriplet()&&(this.components[this.components.length-1].beamRight=e),this.beamRight=e},z.prototype.markNotesWithBeams=function(){if(this.isTriplet())for(let e=0;e<this.components.length-1;e++){const t=this.components[e],n=this.components[e+1];t.canHaveBeamRight()&n.canHaveBeamLeft()&&(t.setBeamRight(!0),n.setBeamLeft(!0))}},Z.prototype=Object.create(MusikipediaBar.prototype),Z.prototype.constructor=MusikipediaBar.prototype,Z.prototype.isBarRest=function(){return 1===this.components.length&&(this.components[0].length===this.metricalStructure.length&&this.components[0].rest&&this.components[0].barRest)},Z.prototype.clearImage=function(){for(const e of this.components)e.removeElements();this.barLineElement&&(this.barLineElement.remove(),this.barLineElement=null)},Z.prototype.markNotesWithBeams=function(){function e(e){for(let t=0;t<e.length-1;t++){const n=e[t],s=e[t+1];n.canHaveBeamRight()&s.canHaveBeamLeft()&&(n.setBeamRight(!0),s.setBeamLeft(!0))}}function t(e){return void 0!==e&&e.some((e=>36===e.length||24===e.length||t(e.components)))}function n(e,t,n){return e.filter((e=>e.position>=t&&e.position+e.length<n+1))}for(const e of this.components)e.markNotesWithBeams();const s=void 0===this.metricalStructure.quaverBeamLevel?this.metricalStructure.tactusLevel:this.metricalStructure.quaverBeamLevel;!function s(i,o,l){const a=l.positionsOfLevel(o);for(let r=0;r<a.length;r++){const c=n(i,a[r],r<a.length-1?a[r+1]:l.length);288===l.timeSignature.length&&1===o&&t(c)?s(c,o+1,l):e(c)}}(this.components,s,this.metricalStructure)},q.prototype=Object.create(MusikipediaRhythm.prototype),q.prototype.constructor=q.prototype,q.prototype.clearImage=function(){for(;L.getElementsByTagName("*").length>0;)L.getElementsByTagName("*")[0].remove();for(const e of this.bars)e.clearImage()},q.prototype.lineOfBar=function(e){return this.bars[e].line},q.prototype.markNotesWithBeams=function(){for(const e of this.bars)e.markNotesWithBeams()},q.prototype.elementsOf=function(e,t){let n=[],s=this.bars[e].arrayOfComponents(),i=s.findIndex((e=>e.position===t));for(;i>=0;){const t=s[i];void 0!==t.element&&null!==t.element&&n.push(t.element),void 0!==t.dotElement&&null!==t.dotElement&&n.push(t.dotElement),void 0!==t.tieElement&&null!==t.tieElement&&n.push(t.tieElement),t.tie?(i++,i>=s.length&&(e++,s=H.bars[e].arrayOfComponents(),i=0)):i=-1}return n},this.disableAnswerButton=function(){M&&(M.disabled=!0)},this.blinkForCorrectAnswer=function(e){pe(""),S&&S.disableButton(!0,!0),T&&T.disableButton(!0,!0),R&&R.disableButton(!0,!0),M&&(M.disabled=!0,M.className+=" rigtigt",M.innerHTML="âœ”ï¸Ž");setTimeout((function(){ue(),void 0!==e&&e()}),1600)},this.indicateWrongAnswer=function(){M&&(M.disabled=!0,M.className+=" forkert",M.innerHTML="âœ˜")},this.blinkForWrongAnswer=function(e){this.indicateWrongAnswer();setTimeout((function(){ue(),void 0!==e&&e()}),800)},
//! EXTERNAL FUNCTIONS
this.getRhythm=function(){return H},this.getZoom=function(){return x},this.getRhythmImageElement=function(){return L},this.setRhythm=function(e){H=e,re()},this.setZoom=function(e){x=e},this.startEditMode=function(e){ye(e)},this.stopEditMode=function(){E=!1,A&&(A.style.display="none",me(!1))},this.showLabelOnComponent=function(e,t){Le(e,t)},this.showLabelForUnknownTab=function(e,t){!function(e,t){e+=Math.floor(t/H.metricalStructure.length),t-=Math.floor(t/H.metricalStructure.length)*H.metricalStructure.length;const n=H.bars[e].arrayOfComponents();let s=n.findIndex((e=>e.position>t));s=s<0?n.length:s;const i=n[s-1],o=i.x+13*x,l=i.position;let a,r;s<n.length?(a=n[s].x,r=n[s].position):(a=H.bars[e].barLineElement.getAttribute("x1"),r=H.metricalStructure.length),Ne((t-l)*(a-o)/(r-l)+o,i.y+29*x,"wrongRhythmNote")}(e,t)},this.markComponent=function(e,t){!function(e,t){"âˆš"==t?(Te(e,"forkertTone"),Te(e,"nbTone"),Ae(e,"rigtigTone")):"Ã·"==t?(Te(e,"rigtigTone"),Te(e,"nbTone"),Ae(e,"forkertTone")):"!"==t?(Te(e,"rigtigTone"),Te(e,"forkertTone"),Ae(e,"nbTone")):(Te(e,"nbTone"),Te(e,"rigtigTone"),Te(e,"forkertTone"))}
//! INFO BOX
(e,t)},this.removeAllLabels=function(){!function(){for(const e of F)e.remove();F=[];for(const e of H.bars)for(const t of e.components){const e=t.allElements();for(const t of e){let e=t.getAttribute("class");new RegExp("(\\s|^)rigtigTone(\\s|$)").test(e)&&(e=e.replace(new RegExp("(\\s|^)rigtigTone(\\s|$)","g"),"$2")),new RegExp("(\\s|^)naestenRigtigTone(\\s|$)").test(e)&&(e=e.replace(new RegExp("(\\s|^)naestenRigtigTone(\\s|$)","g"),"$2")),new RegExp("(\\s|^)forkertTone(\\s|$)").test(e)&&(e=e.replace(new RegExp("(\\s|^)forkertTone(\\s|$)","g"),"$2")),t.setAttribute("class",e)}}}()},this.createInfoBox=function(e,t,n){!function(e,t,n){W=document.createElement("div"),W.id="rhythmTapInfoBox",N.appendChild(W),O=document.createElement("p"),O.className="",O.id="rhythmTapInfoText",W.appendChild(O),I=document.createElement("p"),I.id="rhythmTapInfoImage",I.innerHTML="&nbsp;",W.appendChild(I),void 0!==e&&(W.addEventListener("mousedown",e),W.addEventListener("touchstart",e));const s=document.createElement("p");s.className="svarknapper";const i=document.createElement("button");i.className="svarknap aktiv",i.innerText=t,s.appendChild(i),document.getElementById("svarknapper").appendChild(s),document.getElementById("svarknapper").style.display="none",i.addEventListener("click",n)}(e,t,n)},this.showInfoBox=function(e){!function(e){e?(document.getElementById("svarknapper").style.display="none",W.style.display="block"):W.style.display="none"}(e)},this.showAnswerButton=function(e){me(e)},this.showNextQuestionButton=function(e){!function(e){e?(W.style.display="none",document.getElementById("svarknapper").style.display="block"):document.getElementById("svarknapper").style.display="none"}(e)},this.setInfoBoxText=function(e){!function(e){O.innerHTML=e}(e)},this.setInfoBoxImage=function(e){!function(e){I.innerHTML=void 0===e?"&nbsp;":"getready"===e?"<img src='/files/images/exercises/rhythms/getready.png' />":"listen"===e?"<img src='/files/images/exercises/rhythms/ear.png' />":"tap"===e?"<img src='/files/images/exercises/rhythms/tap.png' />":e}(e)},this.setInfoBoxState=function(e){!function(e){switch(e){case"âˆš":O.className="correct-answer",I.className="correct-answer",W.className="correct-answer";break;case"Ã·":O.className="wrong-answer",I.className="wrong-answer",W.className="wrong-answer";break;default:O.className="",I.className="",W.className=""}}(e)}}MusikipediaEditButton.prototype.disableButton=function(e,t){t=void 0!==t&&t,e?(t&&this.setButton(!1),this.labelElement.style.opacity=.6,this.imageElement.style.opacity=.5,this.labelElement.style.cursor="not-allowed",this.labelElement.className="",this.buttonElement.disabled=!0):(this.labelElement.style.opacity=1,this.imageElement.style.opacity=1,this.labelElement.style.cursor="pointer",this.buttonElement.checked?this.labelElement.className="valgt":this.labelElement.className="",this.buttonElement.disabled=!1)},MusikipediaEditButton.prototype.isChecked=function(){return this.buttonElement.checked},MusikipediaEditButton.prototype.setButton=function(e){this.buttonElement.disabled||(this.buttonElement.checked=e),this.labelElement.className=this.buttonElement.checked&&!this.buttonElement.disabled?"valgt":""};